!function(e){function t(s){if(n[s])return n[s].exports;var i=n[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,s){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:s})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=2)}([function(e,t){var n=Vue.component("task-textarea",{template:'<div>    <div class="task-info">残り {{todo_count}}/{{ count }} タスク. {{todo_sizes}}/{{ sizes }} 規模.</div>    <textarea v-model="text" placeholder="Title 30 Todo/Doing/Done Assignee"></textarea>  </div>',props:["tasks"],data:function(){return{count:0,todo_count:0,doing_count:0,done_count:0,sizes:0,todo_sizes:0,doing_sizes:0,done_sizes:0,text:"",sepaMode:"space"}},watch:{text:function(){this.updateText()},tasks:function(){this.updateTasks()}},mounted:function(){localStorage.text?this.text=localStorage.text:this.text=["タスク1 30 Todo","タスク2 40 Todo","タスク3 50 Todo Cさん","タスク4 60 Todo","タスク5 70 Doing Aさん","タスク6 80 Done","タスク7 55 Todo Aさん","タスク8 45 Doing","タスク9 35 Done Cさん","タスク10 90 Done Bさん"].join("\n")},methods:{getReg:function(e){return"space"==e?/(\S+)[ ]+([\d\.]+)([ ]+(\S+))?([ ]+(\S+))?/:/(.+)[\t]+([\d\.]+)([\t]+(\w+))?([\t]+(.+))?/},getSizes:function(e){return 0==e.length?0:1==e.length?e[0].size:e.map(function(e){return e.size}).reduce(function(e,t){return e+t})},updateText:function(){var e=this;localStorage&&(localStorage.text=e.text),e.sepaMode="space",e.text.match(/\t/)&&(e.sepaMode="tab");var t=e.getReg(e.sepaMode),n={children:null},s=e.text.split("\n").filter(function(e){return null!=e.match(t)}).map(function(e){var n=e.match(t);return{name:n[1],size:Number(n[2]),status:n[4]?n[4]:"Todo",assignee:n[6]}});n.children=s;var i=s.filter(function(e){return null!=e.status&&e.status.match(/Doing/i)}),o=s.filter(function(e){return null!=e.status&&e.status.match(/Done/i)}),a=s.filter(function(e){return null==e.status||!e.status.match(/Done/i)});e.count=s.length,e.todo_count=a.length,e.doing_count=i.length,e.done_count=o.length,e.sizes=e.getSizes(s),e.todo_sizes=e.getSizes(a),e.doing_sizes=e.getSizes(i),e.done_sizes=e.getSizes(o),e.$emit("update-tasks",{tasks:n})},updateTasks:function(){var e=this,t="space"==e.sepaMode?" ":"\t",n=e.tasks.children,s=[];n.forEach(function(e){s.push(e.name+t+e.size+t+e.status+t+(e.assignee?e.assignee:""))}),e.text=s.join("\n")}}});e.exports=n},function(e,t){var n=Vue.component("task-treemap",{template:'<div>    <div class="task-info">      残り規模       <span class="user-info" v-for="user in users" draggable="true" @dragstart="dragstart(user, $event)" @dragend="dragend">        <span v-bind:class="user.class">{{user.name}} {{user.todo_sizes}}/{{user.sizes}}</span>      </span>    </div>    <div id="treemap"></div>  </div>',props:["tasks"],data:function(){return{ColorMax:9,users:[],draggingItem:null,beforeSelected:null}},watch:{tasks:function(){this.setTasks()}},methods:{setTasks:function(){this.update()},getColorNo:function(e){var t=this;return 0==e?0:e%t.ColorMax+1},getStatusColor:function(e){var t="rgb(152, 223, 138)";return null==e?t:e.match(/Done/i)?"rgb(199, 199, 199)":e.match(/Doing/i)?"rgb(174, 199, 232)":t},getSizes:function(e){return 0==e.length?0:1==e.length?e[0].size:e.map(function(e){return e.size}).reduce(function(e,t){return e+t})},update:function(){for(var e=this,t=document.getElementById("treemap");t.firstChild;)t.removeChild(t.firstChild);if(e.users=[],null!=e.tasks&&null!=e.tasks.children&&0!=e.tasks.children.length){var n=e.tasks.children,s={"":{id:0,children:[]}},i=0;n.forEach(function(e){var t=null!=e.assignee?e.assignee:"";null==s[t]?s[t]={id:++i,children:[e]}:s[t].children.push(e)});var o={name:"root_dir",children:Object.keys(s).map(function(e){return{name:e,children:s[e].children}})};e.users=o.children.map(function(t){return{name:t.name,class:"assignee-list-elem task-assignee assignee-"+e.getColorNo(s[t.name].id),sizes:e.getSizes(t.children),todo_sizes:e.getSizes(t.children.filter(function(e){return null==e.status||!e.status.match(/Done/i)}))}});var a=document.getElementById("treemap").clientHeight,r=document.getElementById("treemap").clientWidth,u=d3.layout.treemap().size([r,a]).value(function(e){return e.size});d3.select("#treemap").datum(o).selectAll("div").data(u.nodes).enter().append("div").style("left",function(e){return e.x+"px"}).style("top",function(e){return e.y+"px"}).style("width",function(e){return e.dx-2+"px"}).style("height",function(e){return e.dy-2+"px"}).style("background",function(t,n){return e.getStatusColor(t.status)}).style("position","absolute").style("overflow","hidden").style("border","solid 1px #333").style("padding","0px").on("click",function(t){e.beforeSelected&&(e.beforeSelected.style.borderColor="#333"),e.beforeSelected=d3.select(this)[0][0],e.beforeSelected.style.borderColor="red"}).on("dragover",function(e){d3.event.preventDefault()}).on("drop",function(t){t.assignee=e.draggingItem.name;var s={children:null};s.children=n,e.$emit("update-tasks",{tasks:s})}).html(function(t){return t.children?"":[t.assignee?'<div><span class="task-assignee assignee-'+e.getColorNo(s[t.assignee].id)+'">'+t.assignee+"</span></div>":"",'<div class="task-name">'+t.name+"</div>",'<div class="task-size">'+t.size+"</div>"].join("")})}},dragstart:function(e,t){this.draggingItem=e,t.target.style.opacity=.5},dragend:function(e){e.target.style.opacity=1}}});e.exports=n},function(e,t,n){n(1),n(0);new Vue({el:"#app",data:{tasks:null,textTasks:null},methods:{updateTasks:function(e){this.tasks=e.tasks},updateTextTasks:function(e){this.textTasks=e.tasks}}})}]);